#!/usr/bin/env ruby

# ---
# bin/humidity_control -- Ruby "executable" for monitoring humidity sensors
# ---
require_relative '../lib/humidity_control'

options = {}
OptionParser.new do |opts|
  opts.banner = 'Usage: humidity_control [options]'

  options[:format] = 'text'
  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end
end.parse!

# ---
# Programm laeuft endlos
# - Sensor abfragen
# - auswerten
# - melden
loop do
  begin
    sensor = Sensor.new
  rescue
    Alert.new message: "Something's wrong", level: :alarm
  end
  LOGGER.debug "Sensor reading ist #{sensor.reading}."
  case sensor.reading
  when 'dry'
    Alert.new message: "Everything's ok", level: :info
  else
    Alert.new message: "Humidity sensor is #{sensor.reading}", level: :alarm
  end
  sleep 10
end
